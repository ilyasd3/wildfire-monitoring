---
- name: Automate AWS Lambda Deployment
  hosts: localhost
  connection: local
  vars:
    project_root: "/Users/ilyasd3/wildfire-monitoring"
    lambda_function_name: "WildfireMonitoringFunction"
    zip_file: "{{ project_root }}/terraform/artifacts/lambda_function.zip"
    lambda_folder: "{{ project_root }}/lambda_functions"

  tasks:

    - name: Ensure artifacts directory exists
      file:
        path: "{{ project_root }}/terraform/artifacts"
        state: directory

    - name: Remove old ZIP file if it exists
      file:
        path: "{{ zip_file }}"
        state: absent

    - name: Create ZIP package directly from daily_monitoring_function.py
      command: zip -j {{ zip_file }} {{ lambda_folder }}/daily_monitoring_function.py

    - name: Update AWS Lambda function with new code
      command: >
        aws lambda update-function-code 
        --function-name {{ lambda_function_name }} 
        --zip-file fileb://{{ zip_file }}
      register: lambda_update

    - name: Display AWS Lambda update response
      debug:
        var: lambda_update
